<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Properties – Prime Cyprus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0e17;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --gold: #d4a853;
      --gold-light: #e8c97a;
      --border: rgba(255, 255, 255, 0.06);
      --font-display: 'Playfair Display', Georgia, serif;
      --font-body: 'DM Sans', -apple-system, sans-serif;
      --max-width: 1200px;
      --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    a { color: var(--gold); text-decoration: none; transition: var(--transition); }
    a:hover { color: var(--gold-light); }
    .nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
      background: rgba(10, 14, 23, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }
    .nav__inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 72px;
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 0 24px;
    }
    .nav__logo {
      font-family: var(--font-display);
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .nav__logo .logo-accent { color: var(--gold); }
    .nav__links {
      display: flex;
      align-items: center;
      gap: 36px;
      list-style: none;
    }
    .nav__links a {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-secondary);
    }
    .nav__links a:hover, .nav__links a.active { color: var(--text-primary); }
    .nav__cta { display: flex; align-items: center; }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 24px;
      font-family: var(--font-body);
      font-size: 0.85rem;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: var(--gold);
      color: var(--bg-primary);
      text-decoration: none;
    }
    .btn:hover { background: var(--gold-light); color: var(--bg-primary); }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--font-body);
      padding: 120px 24px 60px;
      max-width: var(--max-width);
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    .sub {
      color: #94a3b8;
      margin-bottom: 32px;
      max-width: 600px;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 24px;
    }
    .card {
      background: #161e2e;
      border-radius: 16px;
      padding: 20px 20px 22px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.6);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .card img {
      width: 100%;
      border-radius: 12px;
      margin: -4px 0 14px;
      max-height: 220px;
      object-fit: cover;
      display: block;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(212,168,83,0.12);
      border: 1px solid rgba(212,168,83,0.35);
      color: #e8c97a;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 8px;
    }
    .card h2 {
      margin: 0 0 6px;
      font-size: 1.2rem;
    }
    .price {
      color: #d4a853;
      font-size: 1.1rem;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .meta {
      color: #94a3b8;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    .description {
      color: #cbd5f5;
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 12px;
      flex: 1;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      padding: 4px 10px;
      font-size: 0.78rem;
      color: #e2e8f0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .cta {
      font-size: 0.85rem;
      color: #e8c97a;
      margin-top: 4px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .cta:hover {
      color: #facc6b;
    }
    .status {
      margin-top: 40px;
      color: #94a3b8;
      font-size: 0.9rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <nav class="nav" role="navigation" aria-label="Main navigation">
    <div class="nav__inner">
      <a href="index.html" class="nav__logo">
        <span class="logo-accent">&#9670;</span> Prime <span class="logo-accent">Cyprus</span>
      </a>
      <ul class="nav__links">
        <li><a href="digital-wealth.html">Digital Wealth</a></li>
        <li><a href="residency-tax.html">Residency &amp; Tax</a></li>
        <li><a href="properties.html" class="active">Properties</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <div class="nav__cta">
        <a href="contact.html" class="btn">Book a Call &rarr;</a>
      </div>
    </div>
  </nav>

  <h1>Properties</h1>
  <p class="sub">Live listings loaded directly from our Sanity CMS. Images are served via Sanity&apos;s global image CDN with on-the-fly optimisation.</p>

  <div id="grid" class="grid"><p class="status">Loading properties…</p></div>
  <p id="status" class="status" style="display:none;"></p>

  <script>
    const query = encodeURIComponent(`*[_type == "property"] | order(_createdAt desc) {
      _id,
      title,
      price,
      location,
      bedrooms,
      bathrooms,
      sizeSqm,
      description,
      featured,
      "imageUrl": coalesce(mainImage.asset->url, image.asset->url, images[0].asset->url)
    }`);

    const endpoint = `https://7ic15vv6.api.sanity.io/v2021-10-21/data/query/production?query=${query}`;

    fetch(endpoint)
      .then(r => r.json())
      .then(data => {
        const grid = document.getElementById('grid');
        const status = document.getElementById('status');
        const props = data.result || [];

        if (!props.length) {
          grid.innerHTML = '';
          status.style.display = 'block';
          status.textContent = 'No properties found. Check back soon for new listings.';
          return;
        }

        grid.innerHTML = props.map(p => {
          const hasImage = !!p.imageUrl;
          const imgUrl = hasImage
            ? `${p.imageUrl}?w=900&h=600&fit=crop&auto=format`
            : '';
          const priceText = typeof p.price === 'number'
            ? `€${p.price.toLocaleString('en-US')}`
            : (p.price || 'Price on application');

          const metaParts = [];
          if (p.location) metaParts.push(p.location);
          if (p.bedrooms) metaParts.push(`${p.bedrooms} bed${p.bedrooms > 1 ? 's' : ''}`);
          if (p.bathrooms) metaParts.push(`${p.bathrooms} bath${p.bathrooms > 1 ? 's' : ''}`);
          if (p.sizeSqm) metaParts.push(`${p.sizeSqm} m²`);
          const metaLine = metaParts.join(' · ');

          const pills = [];
          if (p.featured) pills.push('Featured');
          if (p.sizeSqm) pills.push(`${p.sizeSqm} m²`);

          return `
            <div class="card">
              ${hasImage ? `<img src="${imgUrl}" alt="${(p.title || 'Property in Cyprus').replace(/"/g, '&quot;')}" loading="lazy">` : ''}
              ${p.featured ? '<div class="badge">Featured</div>' : ''}
              <h2>${p.title || 'Property in Cyprus'}</h2>
              <div class="price">${priceText}</div>
              ${metaLine ? `<div class="meta">${metaLine}</div>` : ''}
              ${p.description ? `<p class="description">${p.description}</p>` : ''}
              ${pills.length ? `
                <div class="pill-row">
                  ${pills.map(label => `<span class="pill">${label}</span>`).join('')}
                </div>
              ` : ''}
              <a class="cta" href="contact.html?property=${encodeURIComponent(p._id || '')}">
                Inquire about this property
                <span aria-hidden="true">→</span>
              </a>
            </div>
          `;
        }).join('');
      })
      .catch(e => {
        const grid = document.getElementById('grid');
        const status = document.getElementById('status');
        grid.innerHTML = '';
        status.style.display = 'block';
        status.textContent = 'Error loading properties: ' + e.message;
      });
  </script>
</body>
</html>
