<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Properties – Prime Cyprus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #0a0e17;
      color: #f1f5f9;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 40px 24px 60px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    .sub {
      color: #94a3b8;
      margin-bottom: 32px;
      max-width: 600px;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 24px;
    }
    .card {
      background: #161e2e;
      border-radius: 16px;
      padding: 20px 20px 22px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.6);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .card img {
      width: 100%;
      border-radius: 12px;
      margin: -4px 0 14px;
      max-height: 220px;
      object-fit: cover;
      display: block;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(212,168,83,0.12);
      border: 1px solid rgba(212,168,83,0.35);
      color: #e8c97a;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 8px;
    }
    .card h2 {
      margin: 0 0 6px;
      font-size: 1.2rem;
    }
    .price {
      color: #d4a853;
      font-size: 1.1rem;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .meta {
      color: #94a3b8;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    .description {
      color: #cbd5f5;
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 12px;
      flex: 1;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      padding: 4px 10px;
      font-size: 0.78rem;
      color: #e2e8f0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .cta {
      font-size: 0.85rem;
      color: #e8c97a;
      margin-top: 4px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .cta:hover {
      color: #facc6b;
    }
    .status {
      margin-top: 40px;
      color: #94a3b8;
      font-size: 0.9rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Properties</h1>
  <p class="sub">Live listings loaded directly from our Sanity CMS. Images are served via Sanity&apos;s global image CDN with on-the-fly optimisation.</p>

  <div id="grid" class="grid"><p class="status">Loading properties…</p></div>
  <p id="status" class="status" style="display:none;"></p>

  <script>
    const query = encodeURIComponent(`*[_type == "property"] | order(_createdAt desc) {
      _id,
      title,
      price,
      location,
      bedrooms,
      bathrooms,
      sizeSqm,
      description,
      featured,
      "imageUrl": coalesce(mainImage.asset->url, image.asset->url, images[0].asset->url),
      "slug": slug.current
    }`);

    const endpoint = `https://7ic15vv6.api.sanity.io/v2021-10-21/data/query/production?query=${query}`;

    fetch(endpoint)
      .then(r => r.json())
      .then(data => {
        const grid = document.getElementById('grid');
        const status = document.getElementById('status');
        const props = data.result || [];

        if (!props.length) {
          grid.innerHTML = '';
          status.style.display = 'block';
          status.textContent = 'No properties found. Check back soon for new listings.';
          return;
        }

        grid.innerHTML = props.map(p => {
          const hasImage = !!p.imageUrl;
          const imgUrl = hasImage
            ? `${p.imageUrl}?w=900&h=600&fit=crop&auto=format`
            : '';
          const priceText = typeof p.price === 'number'
            ? `€${p.price.toLocaleString('en-US')}`
            : (p.price || 'Price on application');

          const metaParts = [];
          if (p.location) metaParts.push(p.location);
          if (p.bedrooms) metaParts.push(`${p.bedrooms} bed${p.bedrooms > 1 ? 's' : ''}`);
          if (p.bathrooms) metaParts.push(`${p.bathrooms} bath${p.bathrooms > 1 ? 's' : ''}`);
          if (p.sizeSqm) metaParts.push(`${p.sizeSqm} m²`);
          const metaLine = metaParts.join(' · ');

          const pills = [];
          if (p.featured) pills.push('Featured');
          if (p.sizeSqm) pills.push(`${p.sizeSqm} m²`);

          return `
             <a class="card" href="property-detail.html?slug=${p.slug || ''}" style="text-decoration:none;display:block;">
    ${hasImage ? `<img src="${imgUrl}" alt="${(p.title || 'Property in Cyprus').replace(/"/g, '&quot;')}" loading="lazy">` : ''}
    ${p.featured ? '<div class="badge">Featured</div>' : ''}
    <h2>${p.title || 'Property in Cyprus'}</h2>
    <div class="price">${priceText}</div>
    ${metaLine ? `<div class="meta">${metaLine}</div>` : ''}
    ${p.description ? `<p class="description">${p.description}</p>` : ''}
    ${pills.length ? `
      <div class="pill-row">
        ${pills.map(label => `<span class="pill">${label}</span>`).join('')}
      </div>
    ` : ''}
    <div class="cta">
      View Property →
    </div>
  </a>
          `;
        }).join('');
      })
      .catch(e => {
        const grid = document.getElementById('grid');
        const status = document.getElementById('status');
        grid.innerHTML = '';
        status.style.display = 'block';
        status.textContent = 'Error loading properties: ' + e.message;
      });
  </script>
</body>
</html>
